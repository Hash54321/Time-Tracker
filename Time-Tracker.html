<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Floating Workday Tracker</title>
<style>
:root {
  --bar-height: 12px;
  --bar-radius: 4px;
  --track-color: #e6edf3;
  --green: #4caf50;
  --red: #f44336;
  --tick-color: rgba(0,0,0,0.25);
  --highlight-color: rgba(255,215,0,0.6);
  --font: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
}

body { margin:0; padding:0; font-family: var(--font); background:#f7f9fb; }

/* Floating widget */
#trackerWidget {
  position: fixed;
  top: 60px;
  right: 20px;
  width: 220px;
  background: #fff;
  border: 1px solid #cbd7e6;
  border-radius: 8px;
  padding: 8px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  z-index: 9999;
  cursor: move;
  user-select: none;
}

#trackerHeader {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 12px;
  font-weight: 600;
  margin-bottom: 4px;
}

#toggleBtn {
  font-size: 10px;
  cursor: pointer;
  background: #1976d2;
  color: white;
  border: none;
  border-radius: 4px;
  padding: 1px 4px;
}

#trackerContent {
  display: flex;
  flex-direction: column;
  gap: 4px;
  font-size: 10px;
}

.controls {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
}

input[type="number"] {
  width: 38px;
  padding: 2px 4px;
  font-size: 10px;
  border-radius: 4px;
  border: 1px solid #cbd7e6;
}

button {
  padding: 2px 4px;
  font-size: 10px;
  border-radius: 4px;
  border: none;
  cursor: pointer;
  background-color: #1976d2;
  color: white;
}
button.secondary { background: #6c757d; }
button:disabled { opacity: 0.5; cursor: default; }

#barContainer { display: grid; gap: 3px; width: 100%; }
.hour-row { display: flex; align-items: center; gap: 3px; }
.hour-label { width: 24px; text-align: right; font-size: 8px; color:#1f3a63; }
.bar-wrap { position: relative; flex: 1; height: var(--bar-height); background: var(--track-color); border-radius: var(--bar-radius); overflow: hidden; }
.remaining { position: absolute; left:0; top:0; bottom:0; right:0; background: var(--green); }
.consumed { position:absolute; left:0; top:0; bottom:0; width:0%; background: var(--red); transition: width 1s linear; }

.ticks { position:absolute; left:0; right:0; top:0; bottom:0; pointer-events:none; }
.tick { position:absolute; top:0; height:100%; width:1px; background: var(--tick-color); transform:translateX(-0.5px);}
.tick.highlight { background: var(--highlight-color); width:1px; }
.tick .label { position:absolute; bottom:-10px; font-size:8px; transform:translateX(-50%); }

.time-info { font-size:9px; color:#0a2e5c; margin-bottom:2px; }
.info { font-size:9px; color:#123; }
.watermark { position:absolute; bottom:2px; right:4px; font-size:8px; color:rgba(0,0,0,0.2); pointer-events:none; user-select:none; }
</style>
</head>
<body>

<div id="trackerWidget">
  <div id="trackerHeader">
    Workday Tracker
    <button id="toggleBtn">-</button>
  </div>
  <div id="trackerContent">
    <div class="controls">
      <label>Hrs: <input id="hours" type="number" min="1" max="12" value="8"/></label>
      <button id="startBtn">Start</button>
      <button id="pauseBtn" disabled>Pause</button>
      <button id="resetBtn" class="secondary">Reset</button>
    </div>
    <div class="time-info" id="timeInfo">Start: -- | End: --</div>
    <div id="barContainer"></div>
    <div class="info" id="infoText">Not started yet.</div>
    <div class="watermark">Syed Hisham Q</div>
  </div>
</div>

<script>
  const widget = document.getElementById('trackerWidget');
  const header = document.getElementById('trackerHeader');
  const toggleBtn = document.getElementById('toggleBtn');
  const trackerContent = document.getElementById('trackerContent');

  // Drag functionality
  let isDragging = false, offsetX, offsetY;
  header.addEventListener('mousedown', e=>{
    isDragging=true;
    offsetX = e.clientX - widget.offsetLeft;
    offsetY = e.clientY - widget.offsetTop;
  });
  window.addEventListener('mousemove', e=>{
    if(isDragging){
      widget.style.left = (e.clientX-offsetX)+'px';
      widget.style.top = (e.clientY-offsetY)+'px';
    }
  });
  window.addEventListener('mouseup',()=>{isDragging=false;});

  toggleBtn.addEventListener('click', ()=>{
    if(trackerContent.style.display==='none'){
      trackerContent.style.display='flex';
      toggleBtn.textContent='-';
    } else{
      trackerContent.style.display='none';
      toggleBtn.textContent='+';
    }
  });

  // Tracker JS (same as compact version)
  const hoursInput = document.getElementById('hours');
  const startBtn = document.getElementById('startBtn');
  const pauseBtn = document.getElementById('pauseBtn');
  const resetBtn = document.getElementById('resetBtn');
  const barContainer = document.getElementById('barContainer');
  const infoText = document.getElementById('infoText');
  const timeInfo = document.getElementById('timeInfo');

  let totalHours = 8;
  let bars = [];
  let startTime=null,endTime=null,pausedTime=null,isPaused=false,secondIntervalId=null;
  const STORAGE_KEY='workdayTracker_float';

  function createBars(){
    barContainer.innerHTML=''; bars=[];
    for(let i=0;i<totalHours;i++){
      const row=document.createElement('div'); row.className='hour-row';
      const label=document.createElement('div'); label.className='hour-label'; label.textContent='H'+(i+1);
      const wrap=document.createElement('div'); wrap.className='bar-wrap';
      const remaining=document.createElement('div'); remaining.className='remaining';
      const consumed=document.createElement('div'); consumed.className='consumed';
      const ticks=document.createElement('div'); ticks.className='ticks';
      for(let t=0;t<=6;t++){
        const pos=(t*100/6); const tick=document.createElement('div'); tick.className='tick highlight';
        tick.style.left=pos+'%'; const minuteLabel=document.createElement('div'); minuteLabel.className='label';
        minuteLabel.textContent=(t*10)+'m'; tick.appendChild(minuteLabel); ticks.appendChild(tick);
      }
      wrap.appendChild(remaining); wrap.appendChild(consumed); wrap.appendChild(ticks);
      row.appendChild(label); row.appendChild(wrap);
      barContainer.appendChild(row);
      bars.push({consumed});
    }
  }

  function formatTime(date){ return date.toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'}); }
  function updateTimeInfo(){ if(startTime && endTime){ timeInfo.textContent=`Start: ${formatTime(startTime)} | End: ${formatTime(endTime)}`;} else timeInfo.textContent='Start: -- | End: --';}
  function getElapsedSeconds(){ return startTime?Math.floor((new Date()-startTime)/1000):0; }

  function updateBars(){
    if(!startTime || isPaused) return;
    const elapsed=getElapsedSeconds();
    const totalSeconds=totalHours*3600;
    const hoursElapsed=elapsed/3600;
    const remaining=Math.max(0,totalHours-hoursElapsed);
    infoText.textContent=`Elapsed: ${hoursElapsed.toFixed(2)}h | Remaining: ${remaining.toFixed(2)}h`;
    for(let i=0;i<bars.length;i++){
      const secInHour=Math.min(Math.max(elapsed-i*3600,0),3600);
      bars[i].consumed.style.width=((secInHour/3600)*100).toFixed(3)+'%';
    }
    if(elapsed>=totalSeconds){ infoText.textContent='✅ Workday complete!'; clearInterval(secondIntervalId); localStorage.removeItem(STORAGE_KEY);}
    else saveState();
  }

  function startUpdates(){ clearInterval(secondIntervalId); updateBars(); secondIntervalId=setInterval(updateBars,1000); }
  function saveState(){ localStorage.setItem(STORAGE_KEY,JSON.stringify({totalHours,startTime:startTime?startTime.toISOString():null,endTime:endTime?endTime.toISOString():null,pausedTime:pausedTime?pausedTime.toISOString():null,isPaused})); }
  function loadState(){
    const raw=localStorage.getItem(STORAGE_KEY); if(!raw) return false;
    const data=JSON.parse(raw); if(!data.startTime) return false;
    totalHours=data.totalHours||8; hoursInput.value=totalHours;
    startTime=new Date(data.startTime);
    endTime=data.endTime?new Date(data.endTime):new Date(startTime.getTime()+totalHours*3600*1000);
    pausedTime=data.pausedTime?new Date(data.pausedTime):null;
    isPaused=data.isPaused||false; createBars(); updateTimeInfo();
    if(!isPaused) startUpdates(); updateBars(); pauseBtn.disabled=false; pauseBtn.textContent=isPaused?'Resume':'Pause'; return true;
  }

  startBtn.addEventListener('click',()=>{
    totalHours=parseInt(hoursInput.value)||8; createBars();
    startTime=new Date(); endTime=new Date(startTime.getTime()+totalHours*3600*1000);
    pausedTime=null; isPaused=false; updateTimeInfo(); startUpdates();
    pauseBtn.disabled=false; pauseBtn.textContent='Pause'; saveState();
  });

  pauseBtn.addEventListener('click',()=>{
    if(!startTime) return;
    if(!isPaused){ isPaused=true; pausedTime=new Date(); clearInterval(secondIntervalId); pauseBtn.textContent='Resume'; infoText.textContent='⏸️ Paused';}
    else{ const now=new Date(); const pausedDuration=now-pausedTime;
      startTime=new Date(startTime.getTime()+pausedDuration);
      endTime=new Date(endTime.getTime()+pausedDuration);
      pausedTime=null; isPaused=false; updateTimeInfo(); startUpdates(); pauseBtn.textContent='Pause';}
    saveState();
  });

  resetBtn.addEventListener('click',()=>{
    clearInterval(secondIntervalId); localStorage.removeItem(STORAGE_KEY);
    totalHours=parseInt(hoursInput.value)||8; createBars();
    startTime=null; endTime=null; pausedTime=null; isPaused=false;
    pauseBtn.disabled=true; pauseBtn.textContent='Pause';
    timeInfo.textContent='Start: -- | End: --'; infoText.textContent='Not started yet.';
  });

  createBars(); loadState();
</script>

</body>
</html>
